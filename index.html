<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ID Card Creator | pakposkeren</title>
	<link rel="icon" href="assets/pakposkeren.png" type="image/x-icon">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
	<style>
		body {
			font-family: Ebrima, sans-serif;
			background-color: #f4f4f9;
			margin: 0;
			padding: 0;
			display: flex;
			justify-content: center;
			align-items: center;
			flex-direction: column;
			min-height: 100vh;
			transition: transform 0.3s ease;
		}
		
		.container {
			display: flex;
			flex-wrap: wrap;
			gap: 20px;
			justify-content: center;
			align-items: flex-start;
			padding: 10px;
			padding-bottom: 80px;
		}

		.controls {
			background: #fff;
			padding: 20px;
			border-radius: 8px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			max-width: 300px;
			width: 100%;
			box-sizing: border-box;
			padding-bottom: 60px;
		}

		.controls label {
			display: block;
			margin-bottom: 15px;
			font-size: 14px;
			color: #333;
			font-weight: bold;
		}
		
		#content, #frontCard, #backCard {
			transition: transform 0.3s ease;
		}

		.controls label input {
			width: 100%;
			padding: 10px;
			margin-top: 5px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 14px;
			box-sizing: border-box;
		}

		.controls label input[type="file"] {
			padding: 8px;
		}

		.controls label input[type="range"] {
			padding: 0px;
			accent-color: #671bf7;
		}

		.controls .reset {
			width: auto;
			margin: 0 auto;
			margin-bottom: 5px;
			display: block;
			padding: 10px;
			background-color: #f21173;
			color: #fff;
			border-radius: 4px;
			font-size: 14px;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}
		
		.controls .reset:hover {
			background-color: #d40b62;
		}

		.controls .reset:active {
			background-color: #ad0950;
		}

		.controls button {
			display: inline-block;
			width: 100%;
			padding: 10px;
			background-color: #671bf7;
			color: #fff;
			border: none;
			border-radius: 4px;
			font-size: 16px;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}
		
		.controls span {
			font-size: 16px;
			color: #555;
		}

		.controls button:hover {
			background-color: #5611d9;
		}

		.controls button:active {
			background-color: #4007ad;
		}
		
		.scroll-direction {
			display: flex;
			justify-content: space-between;
			font-size: 14px;
			color: #333;
			font-weight: bold;
		}

		.scroll-direction i {
			margin-top: 3px;
		}
		
		.title {
			display: flex;
			align-items: center;
			gap: 10px;
			flex-wrap: wrap;
			text-align: center;
			justify-content: center;
		}

		.title img {
			display: inline-block;
			max-width: 100%;
			height: auto;
			margin-top: -20px;
		}

		.title p {
			margin-top: -10px;
			margin-bottom: -10px;
			font-size: 15px;
			font-weight: normal;
			color: #8d0aff;
		}
		
		canvas {
			background: #1C2D5A;
			border: 1px solid #ddd;
			border-radius: 8px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			width: 100%;
			max-width: 300px;
			box-sizing: border-box;
		}
		
		.modal {
			display: none;
			position: fixed;
			bottom: 80px;
			left: 50%;
			transform: translateX(-50%);
			width: 95%;
			max-width: 1000px;
			background-color: #fff;
			box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
			border-radius: 10px 10px 0 0;
			padding: 10px 20px 1px 20px;
			z-index: 1000;
			box-sizing: border-box;
			overflow-y: auto;
			
		}

		.modal.active {
			display: block;
		}

		.modal-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0);
			z-index: 999;
			
		}

		.modal-overlay.active {
			display: block;
		}

		.modal label {
			display: block;
			margin-bottom: 15px;
			font-size: 14px;
			color: #333;
			font-weight: bold;
		}

		.modal input[type="range"] {
			width: 100%;
			margin-top: 5px;
			accent-color: #671bf7;
		}

		.modal button {
			margin-top: -10px;
			background-color: #671bf7;
			color: #fff;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}

		.modal button:hover {
			color: #ff0a70;
		}

		.modal button:active {
			color: #9e0545;
		}	
		
		.modal .close-btn {
			position: absolute;
			top: 10px;
			right: 10px;
			font-size: 24px;
			color: #333;
			background: none;
			border: none;
			cursor: pointer;
		}

		.footer-controls {
			position: fixed;
			overflow-x: auto;
			bottom: 0;
			left: 0;
			right: 0;
			background-color: #fff;
			display: flex;
			justify-content: space-around;
			padding: 10px;
			box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
		}

		.footer-controls button {
			background: none;
			border: none;
			font-size: 26px;
			cursor: pointer;
		}
		
		.brightness-button i{
			background-image: radial-gradient(circle, yellow, red);
			-webkit-background-clip: text;
			color: transparent;
			transition: transform 0.6s ease, color 0.6s ease;
		}
		
		.brightness-button:hover i {
			transform: rotate(360deg) scale(1.3);
			background-image: radial-gradient(circle, orange, yellow);
		}
		
		.contrast-button i{
			background-image: linear-gradient(to right, white, black);
			-webkit-background-clip: text;
			color: transparent;
			transition: transform 0.6s ease, opacity 0.6s ease;
		}
		
		.contrast-button:hover i {
			transform: scale(1.3);
			opacity: 0.8;
		}
		
		.saturation-button i{
			background-image: linear-gradient(to right, black, orange, red);
			-webkit-background-clip: text;
			color: transparent;
			transition: transform 0.6s ease, opacity 0.6s ease;
		}
		
		.saturation-button:hover i {
			transform: rotateY(360deg) scale(1.3);
			opacity: 0.8;
		}
		
		.position-button i{
			background-image: radial-gradient(circle, #e8076c, #6a18ed);
			-webkit-background-clip: text;
			color: transparent;
			transition: transform 0.6s ease, color 0.6s ease;
		}

		@keyframes position-bounce-scale {
			0% {
				transform: translateY(0) scale(1);
			}
			25% {
				transform: translateX(-10px) scale(1);
			}
			50% {
				transform: translateY(-10px) scale(1);
			}
			75% {
				transform: translateX(10px) scale(1);
			}
			100% {
				transform: translateY(0) scale(1.3);
			}
		}

		.position-button:hover i {
			animation: position-bounce-scale 0.6s ease-in-out;
			transform: scale(1.3);
		}
		
		.size-button i{
			background-image: radial-gradient(circle, #6a18ed, #e8076c);
			-webkit-background-clip: text;
			color: transparent;
			transition: transform 0.6s ease, opacity 0.6s ease;
		}
		
		.size-button:hover i {
			transform: scale(1.3);
			opacity: 0.8;
		}
		
		.reset-button i{
			background-image: linear-gradient(to right, #18a6ed, #6a18ed);
			-webkit-background-clip: text;
			color: transparent;
			transition: transform 0.6s ease, color 0.6s ease;
		}
		
		.reset-button:hover i {
			transform: rotate(720deg) scale(1.3);
			background-image: radial-gradient(circle, #6a18ed, #18a6ed);
		}
		
		@keyframes reset-aktif {
			0% {
				transform: scale(1.3);
			}
			50% {
				transform: scale(1);
			}
			100% {
				transform: scale(1);
			}
		}
		
		.reset-button:active i {
			animation: reset-aktif 0.2s ease-in-out;
			transform: scale(1.3);
		}

		.download-button i{
			background-image: linear-gradient(to bottom, #18a6ed, #6a18ed);
			-webkit-background-clip: text;
			color: transparent;
			transition: transform 0.6s ease;
		}

		@keyframes bounce-scale {
			0% {
				transform: translateY(0) scale(1);
			}
			50% {
				transform: translateY(10px) scale(1);
			}
			100% {
				transform: translateY(0) scale(1.2);
			}
		}

		.download-button:hover i {
			animation: bounce-scale 0.6s ease-in-out;
			transform: scale(1.2);
		}

		@keyframes download-aktif {
			0% {
				transform: scale(1.2);
			}
			50% {
				transform: scale(1);
			}
			100% {
				transform: scale(1);
			}
		}
		
		.download-button:active i {
			animation: download-aktif 0.2s ease-in-out;
			transform: scale(1.2);
		}
		
		.footer-controls button i {
			display: block;
			font-size: 26px;
			margin-bottom: 10px;
		}
		
		.footer-controls button span {
			display: block;
			color:#6e05f7;
			font-size:12px;
		}

		.footer-controls button:focus {
			outline: none;
		}
			
		@media (max-width: 768px) {
			.container {
				padding-top: 30px;
				padding-bottom: 100px;
			}
			
			.controls {
				max-width: 80%;
			}

			.title {
				flex-direction: column;
				gap: 5px;
			}

			canvas {
				max-width: 80%;
			}
			
			.footer-controls button {
				font-size: 20px;
			}
			
			.footer-controls button span {
				font-size:10px;
			}
		
			.modal {
				display: none;
				position: fixed;
				bottom: 80px;
				left: 50%;
				transform: translateX(-50%);
				width: 95%;
				max-width: 1000px;
				background-color: #fff;
				box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
				border-radius: 10px 10px 0 0;
				padding: 10px 20px 1px 20px;
				z-index: 1000;
				box-sizing: border-box;
				overflow-y: auto;
				
			}

		}
    </style>
</head>

<body>
    <div class="container">
        <div class="controls" id="content">
            <h2 class="title">
                <img src="assets/pakposkeren.png" alt="pakposkeren" height="70">
                ID Card Creator
                <p><i>by : pakposkeren (lagi)</i></p>
            </h2>

            <hr>

            <p class="title" style="font-weight:bold;"><u>Input Data</u></p>
            <label for="name">
                Nama :
                <input type="text" id="name" placeholder="Masukkan Nama" oninput="updateCanvas()">
            </label>
            <label for="idNumber">
                NIPPOS :
                <input type="text" id="idNumber" placeholder="Masukkan NIPPOS" oninput="updateCanvas()">
            </label>
            <label for="photoUpload">
                Foto Diri :
                <input type="file" id="photoUpload" accept="image/*" onchange="processPhoto()">
            </label>
            <p style="font-size:12px; margin-bottom:-5px;">* Latar pada foto diri akan secara otomatis dihapus menggunakan AI.</p>
        </div>

		<canvas id="frontCard" width="638" height="1012"></canvas>
		<canvas id="backCard" width="638" height="1012"></canvas>
		
		<div class="footer-controls">
			<button onclick="openModal('brightness-modal')" class="brightness-button"><i class="fas fa-sun"></i><span>Kecerahan</span></button>
			<button onclick="openModal('contrast-modal')" class="contrast-button"><i class="fas fa-circle"></i><span>Kontras</span></button>
			<button onclick="openModal('saturation-modal')" class="saturation-button"><i class="fas fa-star"></i><span>Saturasi</span></button>
			<button onclick="openModal('size-modal')" class="size-button"><i class="fas fa-arrows-alt"></i><span>Ukuran</span></button>
			<button onclick="openModal('position-modal')" class="position-button"><i class="fas fa-crosshairs"></i><span>Posisi</span></button>
			<button onclick="resetSettings()" class="reset-button"><i class="fas fa-redo"></i><span>Reset</span></button>
			<button onclick="downloadCanvas()" class="download-button"><i class="fas fa-download"></i><span>Download</span></button>
		</div>  
    </div>

	<div class="modal-overlay"></div>

    <!-- Modals for photo settings -->
	<div id="brightness-modal" class="modal">
		<button class="close-btn" onclick="closeModal('brightness-modal')">&times;</button>
		<label for="brightnessBar">
			<div class="scroll-direction">
				<span></span><i class="fas fa-minus"></i>
				<span style="font-weight: bold;">Kecerahan : <span id="brightnessValue">0%</span></span>
				<i class="fas fa-plus"></i><span></span>
			</div>
			<input type="range" id="brightnessBar" min="0" max="200" value="100" oninput="updateCanvas()">
		</label>
	</div>

    <div id="contrast-modal" class="modal">
		<button class="close-btn" onclick="closeModal('contrast-modal')">&times;</button>
        <label for="contrastBar">
            <div class="scroll-direction">
				<span></span><i class="fas fa-minus"></i>
				<span style="font-weight: bold;">Kontras : <span id="contrastValue">0%</span></span>
				<i class="fas fa-plus"></i><span></span>
			</div>
            <input type="range" id="contrastBar" min="0" max="200" value="100" oninput="updateCanvas()">
        </label>
    </div>

    <div id="saturation-modal" class="modal">
		<button class="close-btn" onclick="closeModal('saturation-modal')">&times;</button>
        <label for="saturationBar">
            <div class="scroll-direction">
				<span></span><i class="fas fa-minus"></i>
				<span style="font-weight: bold;">Saturasi : <span id="saturationValue">0%</span></span>
				<i class="fas fa-plus"></i><span></span>
			</div>
            <input type="range" id="saturationBar" min="0" max="200" value="100" oninput="updateCanvas()">
        </label>
    </div>

    <div id="size-modal" class="modal">
		<button class="close-btn" onclick="closeModal('size-modal')">&times;</button>
        <label for="photoWidth">
            <div class="scroll-direction">
				<span></span><i class="fas fa-minus"></i>
				<span style="font-weight: bold;">Lebar</span>
				<i class="fas fa-plus"></i><span></span>
			</div>
            <input type="range" id="photoWidth" min="50" max="1276" value="638" oninput="updateCanvas()">
        </label>
        <label for="photoHeight">
            <div class="scroll-direction">
				<span></span><i class="fas fa-minus"></i>
				<span style="font-weight: bold;">Tinggi</span>
				<i class="fas fa-plus"></i><span></span>
			</div>
            <input type="range" id="photoHeight" min="50" max="2024" value="1012" oninput="updateCanvas()">
        </label>
    </div>

    <div id="position-modal" class="modal">
		<button class="close-btn" onclick="closeModal('position-modal')">&times;</button>
        <label for="photoX">
            <div class="scroll-direction">
				<span></span>Kiri<i class="fas fa-chevron-left"></i>
				<span style="font-weight: bold;">Geser</span>
				<i class="fas fa-chevron-right"></i>Kanan<span></span>
			</div>
            <input type="range" id="photoX" min="-600" max="600" value="0" oninput="updateCanvas()">
        </label>
        <label for="photoY">
		    <div class="scroll-direction">
				<span></span>Atas<i class="fas fa-chevron-up"></i>
				<span style="font-weight: bold;">Geser</span>
				<i class="fas fa-chevron-down"></i>Bawah<span></span>
			</div>
            <input type="range" id="photoY" min="-900" max="900" value="0" oninput="updateCanvas()">
        </label>
    </div>



<script>
	// --- Modal ---
	function openModal(modalId) {
		const modal = document.getElementById(modalId);
		const overlay = document.querySelector('.modal-overlay');

		if (!modal) return;

		if (['brightness-modal', 'contrast-modal', 'saturation-modal'].includes(modalId)) {
			content.style.transform = 'translateY(-60px)';
			frontCard.style.transform = 'translateY(-60px)';
			backCard.style.transform = 'translateY(-60px)';
		}

		if (['position-modal', 'size-modal'].includes(modalId)) {
			content.style.transform = 'translateY(-115px)';
			frontCard.style.transform = 'translateY(-115px)';
			backCard.style.transform = 'translateY(-115px)';
		}

		modal.classList.add('active');
		overlay.classList.add('active');
	}

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        const overlay = document.querySelector('.modal-overlay');
        modal.classList.remove('active');
        overlay.classList.remove('active');
		content.style.transform = 'translateY(0)';
		frontCard.style.transform = 'translateY(0)';
		backCard.style.transform = 'translateY(0)';
    }

    document.querySelector('.modal-overlay').addEventListener('click', () => {
        document.querySelectorAll('.modal').forEach(modal => modal.classList.remove('active'));
        document.querySelector('.modal-overlay').classList.remove('active');
				content.style.transform = 'translateY(0)';
		frontCard.style.transform = 'translateY(0)';
		backCard.style.transform = 'translateY(0)';
    });
	
	//-------------------------------------------------

	const frontCanvas = document.getElementById('frontCard');
	const backCanvas = document.getElementById('backCard');
	const frontCtx = frontCanvas.getContext('2d');
	const backCtx = backCanvas.getContext('2d');

	const frontTemplate = new Image();
	frontTemplate.src = 'assets/depan.png';

	const backTemplate = new Image();
	backTemplate.src = 'assets/belakang.png';

	let photo = null;
	let photoX = 0;
	let photoY = 0;
	let photoWidth = 638;
	let photoHeight = 1012;

	let brightness = 100;
	let contrast = 100;
	let saturation = 100;
	
	const SCALE_FACTOR = 3;

	frontTemplate.onload = updateCanvas;
	backTemplate.onload = updateCanvas;

	function capitalizeWords(str) {
		return str.replace(/\b\w/g, char => char.toUpperCase());
	}

	function updateDisplay() {
	  brightnessValue.textContent = `${brightnessBar.value-100}%`;
	  contrastValue.textContent = `${contrastBar.value-100}%`;
	  saturationValue.textContent = `${saturationBar.value-100}%`;
	}
	
function updateCanvas() {
	console.log("Updating canvas...");
    const scaleFactor = SCALE_FACTOR;

    // Set canvas size for high resolution
    frontCanvas.width = 638 * scaleFactor;
    frontCanvas.height = 1012 * scaleFactor;
    backCanvas.width = 638 * scaleFactor;
    backCanvas.height = 1012 * scaleFactor;

    frontCtx.scale(scaleFactor, scaleFactor);
    backCtx.scale(scaleFactor, scaleFactor);

    // Redraw front template
    frontCtx.clearRect(0, 0, frontCanvas.width, frontCanvas.height);
    frontCtx.drawImage(frontTemplate, 0, 0, frontCanvas.width / scaleFactor, frontCanvas.height / scaleFactor);

    const name = capitalizeWords(document.getElementById('name').value);
    const idNumber = document.getElementById('idNumber').value;

    if (photo) {
		console.log("Drawing photo on canvas...");
        const scaledWidth = photoWidth * SCALE_FACTOR;
        const scaledHeight = photoHeight * SCALE_FACTOR;
        frontCtx.filter = `brightness(${brightness}%) contrast(${contrast}%) saturate(${saturation}%)`;
        frontCtx.drawImage(photo, photoX, photoY, photoWidth, photoHeight);
        frontCtx.filter = 'none';
    }

    frontCtx.font = 'normal 44px Ebrima';
    frontCtx.fillStyle = 'white';
    frontCtx.fillText(name, 62, 327);

    frontCtx.font = '32px Ebrima';
    frontCtx.fillText(`NIPPOS. ${idNumber}`, 62, 375);

    // Redraw back template
    backCtx.clearRect(0, 0, backCanvas.width, backCanvas.height);
    backCtx.drawImage(backTemplate, 0, 0, backCanvas.width / scaleFactor, backCanvas.height / scaleFactor);

    backCtx.font = 'normal 38px Ebrima';
    backCtx.fillStyle = 'white';
    backCtx.fillText(name, 63, 157);

    backCtx.font = '26px Ebrima';
    backCtx.fillText(`NIPPOS. ${idNumber}`, 63, 195);
	
	console.log("Canvas updated successfully.");
}


	function processPhoto() {
		const file = document.getElementById('photoUpload').files[0];
		if (!file) return;

		const formData = new FormData();
		formData.append('image_file', file);

		fetch('https://api.remove.bg/v1.0/removebg', {
			method: 'POST',
			headers: {
				'X-Api-Key': 'sFjZFWE6e83yrkgSEcHT5bGx'
			},
			body: formData
		})
			.then((response) => {
				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}
				return response.blob();
			})
			.then((blob) => {
				const url = URL.createObjectURL(blob);
				photo = new Image();
				photo.onload = () => {
					console.log("Photo loaded successfully");
					updateCanvas();
				};
				photo.src = url;
			})
			.catch((error) => {
				alert('Gagal memproses foto: ' + error.message);
				updateCanvas();
			});
	}

	function createHighResCanvas(originalCanvas, scaleFactor) {
		const highResCanvas = document.createElement('canvas');
		highResCanvas.width = originalCanvas.width * scaleFactor;
		highResCanvas.height = originalCanvas.height * scaleFactor;

		const highResCtx = highResCanvas.getContext('2d');
		highResCtx.scale(scaleFactor, scaleFactor);

		highResCtx.drawImage(originalCanvas, 0, 0, originalCanvas.width, originalCanvas.height);

		return highResCanvas;
	}

function downloadCanvas() {
    const name = capitalizeWords(document.getElementById('name').value).replace(/[^a-zA-Z0-9]/g, '_');

    const highResFrontCanvas = createHighResCanvas(frontCanvas, SCALE_FACTOR);
    const frontLink = document.createElement('a');
    frontLink.download = `${name}_depan.png`;
    frontLink.href = highResFrontCanvas.toDataURL('image/png', 1.0); // Maximum quality
    console.log("Downloading front canvas...");
	frontLink.click();

    const highResBackCanvas = createHighResCanvas(backCanvas, SCALE_FACTOR);
    const backLink = document.createElement('a');
    backLink.download = `${name}_belakang.png`;
    backLink.href = highResBackCanvas.toDataURL('image/png', 1.0); // Maximum quality
    console.log("Downloading back canvas...");
	backLink.click();
}

	document.getElementById('photoX').addEventListener('input', function() {
		photoX = this.value;
		updateCanvas();
	});

	document.getElementById('photoY').addEventListener('input', function() {
		photoY = this.value;
		updateCanvas();
	});

	document.getElementById('photoWidth').addEventListener('input', function() {
		photoWidth = this.value;
		updateCanvas();
	});

	document.getElementById('photoHeight').addEventListener('input', function() {
		photoHeight = this.value;
		updateCanvas();
	});
	
	brightnessBar.addEventListener('input', () => {
		brightness = brightnessBar.value;
		updateDisplay();
		updateCanvas();
	});

	contrastBar.addEventListener('input', () => {
		contrast = contrastBar.value;
		updateDisplay();
		updateCanvas();
	});

	saturationBar.addEventListener('input', () => {
		saturation = saturationBar.value;
		updateDisplay();
		updateCanvas();
	});

	function resetSettings() {
		brightnessBar.value = 100;
		contrastBar.value = 100;
		saturationBar.value = 100;
		photoX = 0;
		photoY = 0;
		photoWidth = 638;
		photoHeight = 1012;

		brightness = 100;
		contrast = 100;
		saturation = 100;

		document.getElementById('photoX').value = photoX;
		document.getElementById('photoY').value = photoY;
		document.getElementById('photoWidth').value = photoWidth;
		document.getElementById('photoHeight').value = photoHeight;

		updateDisplay();
		updateCanvas();
	}
</script>

</body>
</html>
